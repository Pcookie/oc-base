##关于iOS内存问题, 文章仅供参考, 纯属资料整理

####1、RAM ROM

RAM:运行内存，不能掉电储存。ROM:储存性内存，可以掉电储存，例如内存卡，Flash。
由于RAM类型不具备掉电储存能力(即一掉电数据消失)，所以app程序一般存放在ROM中。RAM的访问速度要远高于ROM，价格也要高。

####2、APP程序启动

App程序启动，系统会把开启的那个App程序从Flash或ROM里面拷贝到内存RAM中，然后从内存里面执行代码。
另一个原因是CPU不能直接从内存卡里面读取指令，（需要Flash驱动等等）。

####3、内存分区

![内存分区图](https://github.com/Pcookie/oc-base/blob/master/%20memoryZones/memoryZones/%E5%86%85%E5%AD%98%E5%88%86%E5%8C%BA.png)

* 栈区(stack):
	* 栈区特点:
		* 由编译器自动分配并释放，程序员不需要管理栈区变量的内存；
		* 存放方法调用的实参、局部变量等[先进后出], 一旦出了作用域就会被销毁；函数跳转地址，现场保护等（比如保护下个指令的地址之类的数据）；
		* 栈是系统数据结构，对应线程/进程是唯一的。
		* 栈区地址从高到低分配
		* 优点是快速高效，缺点是有限制，数据不灵活。
	* 栈空间分静态分配和动态分配两种。
		* 静态分配是编译器完成的，比如自动变量(auto)的分配。
		* 动态分配有alloca函数完成。
		* 栈的动态分配无需释放(是自动的)，也就没有释放函数。
		* 为可移植的程序起见，栈的动态分配操作是不被鼓励的。
	* 申请后系统如何响应:
		* 存储每一个函数在执行的时候都会向操作系统索要资源，栈区就是函数运行时的内存，栈区中的变量由编译器负责分配和释放，内存随着函数的运行分配，随着函数的结束而释放，由系统自动完成。
		* 只要栈的剩余空间大于所申请空间，系统将为程序提供内存，否则将报异常提示栈溢出。
	* 申请大小的限制:
		* 栈是向低地址扩展的数据结构，是一块连续的内存的区域。
		* 是栈顶的地址和栈的最大容量是系统预先规定好的，栈的大小是2M（也有的说是1M，总之是一个编译时就确定的常数 ) ,如果申请的空间超过栈的剩余空间时，将提示overflow。因此，能从栈获得的空间较小。
	

	
* 堆区(heap):
	* 堆区特点: 
		* 堆区的内存分配使用的是alloc;
		* 需要程序员管理内存，如果程序员不释放，会出现内存泄漏，程序结束时，可能会有操作系统回收;赋值语句右侧用new方法创建的对象，被创建对象的所有成员变量。
		* ARC的内存的管理，是编译器在编译的时候自动添加retain、release、autorelease;
		* 堆区的地址是从低到高的分配;
		* 有点是灵活方便，数据适应面广泛，但是效率有一定降低。
	* 堆空间:
		* 堆是数据库内部数据结构，不一定唯一
		* 不同堆分配的内存无法互相操作
		* 堆空间的分配总是动态的
	* 申请后系统如何响应:
		* 1.首先应该知道操作系统有一个记录空闲内存地址的链表。
		* 2.当系统收到程序的申请时，会遍历该链表，寻找第一个空间大于所申请空间的堆结点，然后将该结点从空闲结点链表中删除，并将该结点的空间分配给程序。
		* 3 .由于找到的堆结点的大小不一定正好等于申请的大小，系统会自动的将多余的那部分重新放入空闲链表中
	* 申请大小的限制:
		* 堆是向高地址扩展的数据结构，是不连续的内存区域。
		* 这是由于系统是用链表来存储的空闲内存地址的，自然是不连续的，而链表的遍历方向是由低地址向高地址。堆的大小受限于计算机系统中有效的虚拟内存。由此可见，堆获得的空间比较灵活，也比较大。

* 全局区/静态区(static):
	* 包括两个部分：为初始化过的(.bss段)、初始化过的(data段) 这两部分都为程序结束后由系统释放;
	
	>也就是说，（全局区/静态区）在内存中是放在一起的，初始化的全局变量和静态变量在一块区域，未初始化的全局变量和未初始化的静态变量在相邻的另一块区域;
		
		eg: int a;未初始化的。int a = 10; 已初始化的.
* 文字常量区:常量字符串就是放在这里，程序结束后由系统释放；
* 代码区:存放函数体的二进制代码（用来储存程序的代码/指令）程序结束后由系统释放，程序编译链接后的二进制可执行代码;

###注意:
* 在iOS中，堆区的内存是应用程序共享的，堆中的内存分配是系统负责的；
* 系统使用一个链表来维护所以已经分配的内存空间（系统仅仅记录，并不管理具体的内存）;
* 变量使用结束后，需要释放内存，OC中是根据引用计数归零，说明没有任何变量使用该空间，那么系统将直接收回；
* 当一个app启动后，代码区，常量区，全局区大小已固定，因此指向这些区的指针不会产生崩溃性的错误。而堆区和栈区是时时刻刻变化的（堆的创建销毁，栈的弹入弹出），所以当使用一个指针指向这两个区里面的内存时，一定要注意内存是否已经被释放，否则会产生程序崩溃（也就是野指针报错）。